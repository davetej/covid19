import requests
import json

# Airflow API endpoint and credentials
AIRFLOW_URL = 'http://your-airflow-server:port/api/v1'
USERNAME = 'admin'
PASSWORD = 'admin_password'

def get_auth_token():
    """
    Authenticate with the Airflow API and get a bearer token.
    """
    response = requests.post(f"{AIRFLOW_URL}/login", json={"username": USERNAME, "password": PASSWORD})
    response.raise_for_status()  # Raise an error for bad status codes
    return response.json()['id']

def list_roles():
    """
    List all roles in Airflow using the API.
    """
    token = get_auth_token()

    headers = {
        "Authorization": f"Bearer {token}",
        "Content-Type": "application/json"
    }

    response = requests.get(f"{AIRFLOW_URL}/roles", headers=headers)
    response.raise_for_status()  # Raise an error for bad status codes

    roles = response.json()
    return roles

if __name__ == "__main__":
    roles = list_roles()
    print(json.dumps(roles, indent=2))
