# custom_permissions.py

from airflow.security.permissions import BaseDagPermission

class CustomDagPermission(BaseDagPermission):
    def can_access_dag(self, user, dag):
        # Check if the user belongs to the team corresponding to the DAG owner
        user_teams = user.teams  # Assuming user.teams provides a list of teams the user belongs to
        dag_owner_team = dag.owner_team  # Assuming dag.owner_team provides the team of the DAG owner
        
        if dag_owner_team in user_teams:
            return True
        
        return False

# Update Airflow's DAG view to use the custom permission class
from airflow.www.security import permissions as web_permissions
web_permissions.ACTION_CAN_READ = CustomDagPermission()
